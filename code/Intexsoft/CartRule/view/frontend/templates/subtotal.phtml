<?php
/** @var Totals $block  */

use Intexsoft\CartRule\Block\Cart\Totals;
?>
<?php
$totals = $block->getTotals() ;
$block->setAttrCartValue();
?>
<table class="data table totals">
    <tbody>
    <?php foreach($totals as $key => $total) :?>
        <?php if(!empty($total->getValue())) :?>
            <tr>
                <th><?= $total->getTitle()->getText() ?></th>
                <td>
                    <span class="price" id="subtotal"><?= $this->helper('Magento\Framework\Pricing\Helper\Data')->currency(number_format($total->getValue(),2),true,false) ?></span>
                </td>
            </tr>
        <?php endif ?>
    <?php endforeach ?>
    </tbody>
</table>

<script>
    let getJSON = function(url, callback) {

        let xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.responseType = 'json';
        xhr.onload = function() {

            let status = xhr.status;

            if (status === 200) {
                callback(null, xhr.response);
            } else {
                callback(status);
            }
        };

        xhr.send();
    };
    let cartTotal = document.querySelector(".content");
    var graph = document.createElement('div');
    graph.id = "cart-info";
    cartTotal.append(graph);
    cartTotal = document.querySelector("#cart-info");

    let tocart = document.querySelectorAll(".tocart");
    getJSON('http://bsh.loc/default/customer/section/load/?sections=cart', function (err, data) {
        if (err != null) {
            console.error(err);
        } else {
            cartTotal.textContent = `${data.cart.subtotalAmount}`;
        }
    });
    for (let i = 0; i < tocart.length; i++) {
        tocart[i].addEventListener("click", function () {
            getJSON('http://bsh.loc/default/customer/section/load/?sections=cart', function (err, data) {
                if (err != null) {
                    console.error(err);
                } else {
                   cartTotal.textContent = `${data.cart.subtotalAmount}`;
                }
            });
        });
    }
</script>



<!--"[data-role=swatch-option-1570]": {-->
<!--"Magento_Swatches/js/swatch-renderer": {-->
<!--"selectorProduct": ".product-item-details",-->
<!--"onlySwatches": true,-->
<!--"enableControlLabel": false,-->
<!--"numberToShow": 16,-->
<!--"jsonConfig": {"attributes":{"148":{"id":"148","code":"size","label":"Size","options":[{"id":"169","label":"XS","products":["1555","1556","1557"]},{"id":"170","label":"S","products":["1558","1559","1560"]},{"id":"171","label":"M","products":["1561","1562","1563"]},{"id":"172","label":"L","products":["1564","1565","1566"]},{"id":"173","label":"XL","products":["1567","1568","1569"]}],"position":"0"},"93":{"id":"93","code":"color","label":"Color","options":[{"id":"53","label":"Blue","products":["1555","1558","1561","1564","1567"]},{"id":"59","label":"Orange","products":["1556","1559","1562","1565","1568"]},{"id":"60","label":"Purple","products":["1557","1560","1563","1566","1569"]}],"position":"1"}},"template":"\u20ac<%- data.price %>","currencyFormat":"\u20ac%s","optionPrices":{"1555":{"baseOldPrice":{"amount":22},"oldPrice":{"amount":22},"basePrice":{"amount":22},"finalPrice":{"amount":22},"tierPrices":[],"msrpPrice":{"amount":0}},"1556":{"baseOldPrice":{"amount":22},"oldPrice":{"amount":22},"basePrice":{"amount":22},"finalPrice":{"amount":22},"tierPrices":[],"msrpPrice":{"amount":0}},"1557":{"baseOldPrice":{"amount":22},"oldPrice":{"amount":22},"basePrice":{"amount":22},"finalPrice":{"amount":22},"tierPrices":[],"msrpPrice":{"amount":0}},"1558":{"baseOldPrice":{"amount":22},"oldPrice":{"amount":22},"basePrice":{"amount":22},"finalPrice":{"amount":22},"tierPrices":[],"msrpPrice":{"amount":0}},"1559":{"baseOldPrice":{"amount":22},"oldPrice":{"amount":22},"basePrice":{"amount":22},"finalPrice":{"amount":22},"tierPrices":[],"msrpPrice":{"amount":0}},"1560":{"baseOldPrice":{"amount":22},"oldPrice":{"amount":22},"basePrice":{"amount":22},"finalPrice":{"amount":22},"tierPrices":[],"msrpPrice":{"amount":0}},"1561":{"baseOldPrice":{"amount":22},"oldPrice":{"amount":22},"basePrice":{"amount":22},"finalPrice":{"amount":22},"tierPrices":[],"msrpPrice":{"amount":0}},"1562":{"baseOldPrice":{"amount":22},"oldPrice":{"amount":22},"basePrice":{"amount":22},"finalPrice":{"amount":22},"tierPrices":[],"msrpPrice":{"amount":0}},"1563":{"baseOldPrice":{"amount":22},"oldPrice":{"amount":22},"basePrice":{"amount":22},"finalPrice":{"amount":22},"tierPrices":[],"msrpPrice":{"amount":0}},"1564":{"baseOldPrice":{"amount":22},"oldPrice":{"amount":22},"basePrice":{"amount":22},"finalPrice":{"amount":22},"tierPrices":[],"msrpPrice":{"amount":0}},"1565":{"baseOldPrice":{"amount":22},"oldPrice":{"amount":22},"basePrice":{"amount":22},"finalPrice":{"amount":22},"tierPrices":[],"msrpPrice":{"amount":0}},"1566":{"baseOldPrice":{"amount":22},"oldPrice":{"amount":22},"basePrice":{"amount":22},"finalPrice":{"amount":22},"tierPrices":[],"msrpPrice":{"amount":0}},"1567":{"baseOldPrice":{"amount":22},"oldPrice":{"amount":22},"basePrice":{"amount":22},"finalPrice":{"amount":22},"tierPrices":[],"msrpPrice":{"amount":0}},"1568":{"baseOldPrice":{"amount":22},"oldPrice":{"amount":22},"basePrice":{"amount":22},"finalPrice":{"amount":22},"tierPrices":[],"msrpPrice":{"amount":0}},"1569":{"baseOldPrice":{"amount":22},"oldPrice":{"amount":22},"basePrice":{"amount":22},"finalPrice":{"amount":22},"tierPrices":[],"msrpPrice":{"amount":0}}},"priceFormat":{"pattern":"\u20ac%s","precision":2,"requiredPrecision":2,"decimalSymbol":".","groupSymbol":",","groupLength":3,"integerRequired":false},"prices":{"baseOldPrice":{"amount":22},"oldPrice":{"amount":22},"basePrice":{"amount":22},"finalPrice":{"amount":22}},"productId":"1570","chooseText":"Choose an Option...","images":[],"index":{"1555":{"148":"169","93":"53"},"1556":{"148":"169","93":"59"},"1557":{"148":"169","93":"60"},"1558":{"148":"170","93":"53"},"1559":{"148":"170","93":"59"},"1560":{"148":"170","93":"60"},"1561":{"148":"171","93":"53"},"1562":{"148":"171","93":"59"},"1563":{"148":"171","93":"60"},"1564":{"148":"172","93":"53"},"1565":{"148":"172","93":"59"},"1566":{"148":"172","93":"60"},"1567":{"148":"173","93":"53"},"1568":{"148":"173","93":"59"},"1569":{"148":"173","93":"60"}},"channel":"website","salesChannelCode":"base","sku":{"1555":"WS12-XS-Blue","1556":"WS12-XS-Orange","1557":"WS12-XS-Purple","1558":"WS12-S-Blue","1559":"WS12-S-Orange","1560":"WS12-S-Purple","1561":"WS12-M-Blue","1562":"WS12-M-Orange","1563":"WS12-M-Purple","1564":"WS12-L-Blue","1565":"WS12-L-Orange","1566":"WS12-L-Purple","1567":"WS12-XL-Blue","1568":"WS12-XL-Orange","1569":"WS12-XL-Purple"}},-->
<!--"jsonSwatchConfig": {"148":{"169":{"type":"0","value":"XS","label":"XS"},"170":{"type":"0","value":"S","label":"S"},"171":{"type":"0","value":"M","label":"M"},"172":{"type":"0","value":"L","label":"L"},"173":{"type":"0","value":"XL","label":"XL"},"additional_data":"{\"swatch_input_type\":\"text\",\"update_product_preview_image\":1,\"use_product_image_for_swatch\":0}"},"93":{"53":{"type":"1","value":"#1857f7","label":"Blue"},"59":{"type":"1","value":"#eb6703","label":"Orange"},"60":{"type":"1","value":"#ef3dff","label":"Purple"},"additional_data":"{\"swatch_input_type\":\"visual\",\"update_product_preview_image\":1,\"use_product_image_for_swatch\":0}"}},-->
<!--"mediaCallback": "http\u003A\u002F\u002Fbsh.loc\u002Fdefault\u002Fswatches\u002Fajax\u002Fmedia\u002F",-->
<!--"jsonSwatchImageSizeConfig": {"swatchImage":{"width":30,"height":20},"swatchThumb":{"height":90,"width":110}},-->
<!--"showTooltip": 1                }-->
<!--}-->
